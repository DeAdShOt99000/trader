{% extends 'base.html' %}

{% block title %} Trader - Favourites {% endblock %}

{% block head %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/partials/item.css') }}">
    <script src="{{ url_for('static', filename='js/search-location.js') }}" defer></script>
{% endblock %}

{% block nav_search %}nav-search{% endblock %}
{% block search_location %}
    <input type="search" class="search" placeholder="Search...">
    <div class="location-cont">
        <div>Location</div>
        <select name="location" class="location" title="Location">
            <option class="all" value="">All</option>
            <option class="maadi" value="maadi">Maadi</option>
            <option class="october" value="october">6 October</option>
            <option class="faisal" value="faisal">Faisal</option>
            <option class="madenti" value="madenti">Madenti</option>
            <option class="haram" value="haram">Haram</option>
        </select>
    </div>
{% endblock %}

{% block content %}
    <header class="pge-header" style="margin: 15px;">- Favourites -</header>
    <div class="items-cont seller-items-cont">
        {% for item in fav_items %}
            {% with seller_page=True, fav_page=True %}
                {% include 'partials/item.html' %}
            {% endwith %}
        {% endfor %}
    </div>
    <div class='no-fav empty-pge' style="display: none;">No favourites, <a href="{{ url_for('index') }}">Browse all items!</a></div>

    <script>
        // Select all elements with the class "favourite-btn" and the element with class "no-fav"
        const favouriteBtns = document.querySelectorAll('.favourite-btn');
        const noFav = document.querySelector('.no-fav');

        // Check if there are any favorite buttons found in the document
        if (favouriteBtns.length) {
            // Iterate over each favorite button
            for (let fav of favouriteBtns) {
                // Add a click event listener to each favorite button
                fav.addEventListener('click', function() {
                    // Extract the item ID from the favorite button's ID attribute
                    const itemId = this.id.split('-')[2];

                    // Make a fetch request to the server to remove the item from favorites
                    fetch(`/favourite-json/${itemId}`);

                    // Remove the item element from the document with the corresponding item ID
                    document.querySelector(".items-cont").removeChild(document.getElementById(`item-${itemId}`));

                    // Check if there are no more items in the items container
                    if (document.querySelector('.items-cont').children.length < 1) {
                        // If no items are left, display the element with class "no-fav"
                        noFav.style.display = 'block';
                    };
                });
            };
        } else {
            // If no favorite buttons are found, display the element with class "no-fav"
            noFav.style.display = 'block';
        };
    </script>
{% endblock %}